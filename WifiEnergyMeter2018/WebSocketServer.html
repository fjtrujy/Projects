<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
    <head>
        <meta charset="utf-8">
        <title>
            WebSocket Test
        </title>
        <style>
        	#redbar {
        		color: #fff;
        		background-color: #f00;
        		width: 500px;
        		height: 30px;
        	}
        	#greenbar {
        		color: #fff;
        		background-color: #0f0;
        		width: 500px;
        		height: 30px;
        	}
        	#bluebar {
        		color: #fff;
        		background-color: #00f;
        		width: 500px;
        		height: 30px;
        	}        	        	
        </style>

		<script language = "javascript"type = "text/javascript">
			var wsUri = "ws://192.168.1.142:88/";
			var output;
			
			function init() {
			    testWebSocket();
			}
			
			function testWebSocket() {
			    websocket = new WebSocket(wsUri);
			    websocket.onopen = function(evt) {
			        console.log("CONNECTED");
			    };
			    websocket.onclose = function(evt) {
			        console.log("DISCONNECTED");
			    };
			    websocket.onmessage = function(evt) {
			    	var pin = evt.data.toString();
if (pin.substr(0,2) == "a=")
{
  update(pin.substr(2));
  return;
}
console.log(pin);

			    };
			    websocket.onerror = function(evt) {
			        console.log("ERROR: " + evt.data);
			    };
			}
			
			function changeRed() {
				var value = document.getElementById("red").checked;
				var message = "d8";
				
				message += value ? "1" : "0";
				
			    console.log("SENT: " + message);
			    websocket.send(message);
			}
			
			function changeGreen() {
				var value = document.getElementById("green").checked;
				var message = "d9";
				
				message += value ? "1" : "0";
				
			    console.log("SENT: " + message);
			    websocket.send(message);
			}			
			
			
			window.addEventListener("load", init, false); 

        </script>
    </head>
    <body>
        <h2>
            WebSocket Test
        </h2>
<canvas id="graf" width="800" height="200"></canvas>

		<input id="red" type="checkbox" onchange="changeRed();">Pin 8</input>
		<input id="green" type="checkbox" onchange="changeGreen();">Pin 9</input>

<script>
var can = document.getElementById("graf");
var ctx = can.getContext("2d");
var x = 0;
var ly = 0;
  ctx.lineWidth = 1.1;
  ctx.strokeColor = "#000000";
  ctx.fillStyle = "rgba(255, 255, 200, 1)";
//console.log(can.height);
function update(v)
{
  var y = (1-parseInt(v)/1024)*can.height;

  ctx.fillRect(x+1, 0, 4, can.height);

  ctx.beginPath();
  ctx.moveTo(x, ly);
  ctx.lineTo(++x, y);
  ctx.stroke();
  ly = y;
  if (x>can.width)
    x = 0;
}

</script>
    </body>
</html>
